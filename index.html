<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thiệp Kỉ Yếu Hoàn Chỉnh</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Montserrat:wght@400;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        :root { --gold: #e5b869; --dark: #3a3a3a; --bg-color: #fffaf0; }
        body { margin: 0; background-color: var(--bg-color); display: flex; flex-direction: column; align-items: center; min-height: 100vh; font-family: 'Montserrat', sans-serif; }

        /* Bảng điều khiển */
        #control-panel { background: white; padding: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); z-index: 100; display: flex; flex-wrap: wrap; gap: 10px; width: 100%; justify-content: center; position: sticky; top: 0; }
        .input-group { display: flex; flex-direction: column; gap: 2px; }
        .input-group label { font-size: 10px; font-weight: 700; color: var(--gold); }
        .input-group input { padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; }
        .btn-save { background: #d4a75a; color: white; border: none; padding: 10px 25px; border-radius: 4px; font-weight: 700; cursor: pointer; align-self: flex-end; }

        /* Vùng thiệp */
        #capture-area { padding: 40px; }
        .invitation-card {
            background-color: white; width: 850px; height: 550px; display: flex;
            position: relative; padding: 90px 40px 40px 40px; box-sizing: border-box;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.1);
            border: 1px solid #eee;
        }

        /* FIX CÁI MŨ: Dùng Div + Background thay vì SVG trực tiếp */
        .grad-cap-fix {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 80px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Cpath d='M256 32L32 128l224 96 224-96L256 32z' fill='%23333'/%3E%3Cpath d='M416 172.8V320c0 35.3-71.6 64-160 64s-160-28.7-160-64V172.8l160 68.6 160-68.6z' fill='%23444'/%3E%3Cpath d='M448 128v192h-32V128h32z' fill='%23e5b869'/%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
            z-index: 10;
        }

        /* Nội dung thiệp */
        .left-side, .right-side { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .divider { width: 1px; background: #eee; height: 80%; margin: 0 20px; }
        .text-thu-moi { font-family: 'Great Vibes', cursive; font-size: 70px; margin: 0; }
        .text-ki-yeu { font-family: 'Playfair Display', serif; font-size: 55px; color: var(--gold); letter-spacing: 4px; margin: 0; }
        .owner-name { font-family: 'Great Vibes', cursive; font-size: 35px; color: var(--dark); margin: 5px 0; }
        .title-main { font-family: 'Playfair Display', serif; font-size: 26px; border-bottom: 2px solid var(--gold); padding-bottom: 5px; margin-bottom: 20px; }
        .date-box { display: flex; align-items: center; gap: 12px; border-top: 1px solid #333; border-bottom: 1px solid #333; padding: 8px 20px; margin-bottom: 15px; }
        .big-day { font-size: 35px; color: var(--gold); font-family: 'Playfair Display', serif; }
        .date-info-stack { display: flex; flex-direction: column; font-size: 11px; text-align: left; line-height: 1.2; font-weight: 600; }
        
        #notification { position: fixed; bottom: 20px; right: 20px; background: #333; color: white; padding: 15px 25px; border-radius: 8px; display: none; z-index: 1000; }
    </style>
</head>
<body>

    <div id="control-panel">
        <div class="input-group"><label>Bạn thân</label><input type="text" id="in-name" placeholder="Tên..." oninput="sync()"></div>
        <div class="input-group"><label>Tên bạn</label><input type="text" id="in-owner" placeholder="Bạn..." oninput="sync()"></div>
        <div class="input-group"><label>Ngày lễ</label><input type="date" id="in-date" value="2026-03-01" oninput="sync()"></div>
        <div class="input-group"><label>Giờ</label><input type="time" id="in-time" value="09:30" oninput="sync()"></div>
        <div class="input-group"><label>Lớp</label><input type="text" id="in-class" value="12A4" oninput="sync()"></div>
        <div class="input-group"><label>Địa điểm</label><input type="text" id="in-loc" value="Trường THPT TG2" oninput="sync()"></div>
        <button class="btn-save" onclick="saveImage()">LƯU THIỆP</button>
    </div>

    <div id="capture-area">
        <div class="invitation-card" id="my-card">
            <div class="grad-cap-fix"></div>

            <div class="left-side">
                <h1 class="text-thu-moi">Thu mời</h1>
                <h2 class="text-ki-yeu">KỈ YẾU</h2>
                <div style="text-align: center; margin-top: 10px;">
                    <span style="font-size: 10px; color: #999;">FROM</span>
                    <p class="owner-name" id="out-owner">Your Name</p>
                </div>
            </div>

            <div class="divider"></div>

            <div class="right-side">
                <div class="title-main">INVITATION</div>
                <div style="font-size: 14px; text-align: center; line-height: 1.6;">
                    Thân mời: <span id="out-name" style="font-weight: 700; color: #b38b4d;">Bạn của tớ</span><br>
                    Đến dự kỉ yếu cùng tớ nhé!
                </div>
                <div style="font-family: 'Great Vibes', cursive; font-size: 40px; color: var(--gold); margin: 10px 0;" id="out-class">Class of 12A4</div>
                
                <div class="date-box">
                    <div class="date-info-stack">
                        <span id="out-month">THÁNG 03</span>
                        <span id="out-year">NĂM 2026</span>
                    </div>
                    <span class="big-day" id="out-day">01</span>
                    <div class="date-info-stack">
                        <span style="color:var(--gold)">VÀO LÚC</span>
                        <span id="out-time-display" style="font-size: 16px;">09:30 AM</span>
                    </div>
                </div>
                <div style="font-size: 12px; font-weight: 700;" id="out-loc">Trường THPT TG2</div>
            </div>
        </div>
    </div>

    <div id="notification">✓ Đã tải xuống thiệp!</div>

    <script>
        function formatTime(timeStr) {
            if(!timeStr) return "09:30 AM";
            let [h, m] = timeStr.split(':');
            let ampm = h >= 12 ? 'PM' : 'AM';
            h = h % 12 || 12;
            return `${String(h).padStart(2, '0')}:${m} ${ampm}`;
        }

        function sync() {
            document.getElementById('out-name').innerText = document.getElementById('in-name').value || "Bạn của tớ";
            document.getElementById('out-owner').innerText = document.getElementById('in-owner').value || "Your Name";
            document.getElementById('out-class').innerText = "Class of " + (document.getElementById('in-class').value || "12A4");
            document.getElementById('out-loc').innerText = document.getElementById('in-loc').value || "Trường THPT TG2";
            document.getElementById('out-time-display').innerText = formatTime(document.getElementById('in-time').value);
            
            const d = new Date(document.getElementById('in-date').value);
            if(!isNaN(d)) {
                document.getElementById('out-day').innerText = String(d.getDate()).padStart(2, '0');
                document.getElementById('out-month').innerText = "THÁNG " + String(d.getMonth() + 1).padStart(2, '0');
                document.getElementById('out-year').innerText = "NĂM " + d.getFullYear();
            }
        }

        function saveImage() {
            const card = document.getElementById('my-card');
            const toast = document.getElementById('notification');
            
            // Tăng scale để ảnh cực rõ nét
            html2canvas(card, { 
                scale: 3, 
                useCORS: true, 
                logging: false,
                allowTaint: true 
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = 'thiep-ki-yeu.png';
                link.href = canvas.toDataURL("image/png");
                link.click();
                toast.style.display = 'block';
                setTimeout(() => toast.style.display = 'none', 3000);
            });
        }
        sync();
    </script>
</body>
</html>
